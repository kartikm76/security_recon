## Setup

Create or activate the virtual environment of your choice, then install the project in editable mode. Using `uv`:

```bash
uv sync
# or, if you already have a venv
uv pip install -e .[dev]
```

The package lives under `src/main/python/security_recon`; once installed, it is importable everywhere within the environment.

## Running the application

```bash
uv run application.py
```

## Tests

Pytest suites are under `src/test/python/security_recon_tests`. Execute them with:

```bash
uv run -m pytest -q
```

Verbose run:

```bash
uv run -m pytest -vv
```

## Project layout

```
security_recon/
├── application.py                       # Thin wrapper around pipeline CLI
├── parquet/                             # Sample parquet outputs generated by the run
├── src/
│   ├── main/
│   │   ├── python/
│   │   │   └── security_recon/
│   │   │       ├── __init__.py
│   │   │       ├── controller/          # CLI + UI entry points (pipeline runner, diagnostics, UI shell)
│   │   │       ├── domain/              # Data dictionary models, loaders, metrics schema
│   │   │       ├── integration/         # External adapters (e.g., parquet writer)
│   │   │       ├── repositories/        # SQLAlchemy repositories and ORM models
│   │   │       ├── service/             # Business orchestration (pipeline runner, dataframe differ)
│   │   │       └── support/             # Infrastructure helpers (logging, DB manager/service, paths)
│   │   └── resources/
│   │       ├── application.yml          # DB configuration, logging, parquet settings
│   │       └── data_dictionary.yml      # Attribute reconciliation rules
│   └── test/
│       └── python/
│           └── security_recon_tests/    # Pytest suites mirroring src/main structure
└── uv.lock                              # Environment lockfile for uv
```

## Sample Curl Commands
# POST /runs/ – start a run for an as-of date
```
curl -X POST "http://127.0.0.1:8000/runs/" \
  -H "Content-Type: application/json" \
  -d '{"as_of_date": "2023-12-30"}'
```

# GET /run-ids/ – list run summaries for a date
```
curl "http://127.0.0.1:8000/run-ids/?as_of_date=2023-12-30"
```

# GET /runs/{run_id}/artifact – fetch latest artifact for a run
```
curl "http://127.0.0.1:8000/runs/<run_id>/artifact"
```

## Docker
# Build the Docker image
```
docker build -t security-recon-api .
```

# Run the image
```
docker run --rm -p 8000:8000   -e POSTGRES_DATABASE_URL="postgresql+psycopg://postgres:Postgres%40XXXX@host.docker.internal:5432/postgres"   -e MYSQL_DATABASE_URL="mysql+pymysql://root:Guruji%40XXXX@host.docker.internal:3306/legacy_security_master"   security-recon-api:latest
```
